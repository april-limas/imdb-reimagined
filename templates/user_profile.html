{% extends 'base.html' %}

{% block navbar %}
    {% include 'navbar.html' %}
{% endblock %}

{% block content %}

    <h4 class="movie-title">{{user.username}}'s Profile</h4>
    
    <div class="profile-container" id='about'>
        <div class="cols photo-col" >
            {% if request.user.profile_pic %}
                <div class="image-container">
                    <img class="profile-image" src ='{{user.profile_pic.url}}' />
                </div>
            {% endif %}
            <a href="#" onclick="editPhoto()" class="edit-link">edit</a>
        </div>
        <div class="cols info-col">
            <h5 style="display: inline-block">{{user.displayname}}</h5>
            <a href="#" onclick="editDisplayname()">edit</a>
            <br>
            {% if user.bio %}
                <div style="display: inline-block">
                    {% if user.bio %}
                        <h6>About Me: <span class="edit-link"><a href="#" onclick="editBio()">edit</a></span></h6>
                        <h6>{{request.user.bio}}</h6>
                    {% endif %}
                </div>
            {% else %} 
                <h6>Say Something About Yourself: <span class="edit-link"><a href="#" onclick="editBio()">add</a></span></h6></h5>
            {% endif %}
        </div>

        <div class="cols review-col">
            {% if reviews.count > 0 %}
                <h6>Reviews Posted: {{reviews.count}}</h6>
            {% else %}
                <h6>Post your first review to get some karma points!</h6>
            {% endif %}
            <br>
            <h6>Karma: {{request.user.karma_score}} {{request.user.emoji}}</h6> 
        </div>
    </div>

    <div class="carousel-container">
        <h5 class="list-title">Watch List</h5>
        <div class="carousel">
            <ul>
                {% for movie in user.watch_list.all %}
                    <div class="carousel-item">
                        {% if request.user.is_authenticated %}
                            {% if movie in request.user.watch_list.all %}
                                <a href="{% url 'remove_watchlist' tmdb_id=movie.tmdb_id %}" class="icon"><i class="far fa-check-square"></i></a>
                            {% else %}
                                <a href="{% url 'add_watchlist' tmdb_id=movie.tmdb_id %}" class="icon"><i class="far fa-plus-square"></i></a>
                            {% endif %}
                            {% if movie in user.favorites_list.all %}
                                <a href="{% url 'remove_favorites' movie_id=movie.tmdb_id %}" class="icon"><i class="far fa-eye"></i></a>
                            {% else %}
                                <a href="{% url 'add_favorites' movie_id=movie.tmdb_id %}" class="icon"><i class="far fa-eye-slash"></i></a>
                            {% endif %}
                            {% if movie in review.movie.all %}
                                <a href="#" class="icon"><i class="far fa-list-alt"></i></a>
                            {% else %}
                                <a href="{% url 'post_review' tmdb_id=movie.tmdb_id %}" class="icon"><i class="far fa-edit"></i></a>
                            {% endif %}
                        {% endif %}
                        <a href="{% url 'movie_detail' movie_id=movie.tmdb_id %}">
                            <img src="{{movie.poster_url}}" alt="{{movie.name}}" width=220>
                        </a>
                        <h6><a href="{% url 'movie_detail' movie_id=movie.tmdb_id %}">{{ movie.name }}</a></h6>
                    </div>
                {% endfor %}
            </ul>
        </div>
    </div>

    <div class="carousel-container">
        <h5 class="list-title">You Posted {{reviews.count}} Review(s)</h5>
        <div class="carousel">
            <ul>
                {% for review in reviews %}
                    <div class="carousel-item">
                        {% if request.user.is_authenticated %}
                            {% if review.movie in request.user.watch_list.all %}
                                <a href="{% url 'remove_watchlist' tmdb_id=review.movie.tmdb_id %}" class="icon"><i class="far fa-check-square"></i></a>
                            {% else %}
                                <a href="{% url 'add_watchlist' tmdb_id=review.movie.tmdb_id %}" class="icon"><i class="far fa-plus-square"></i></a>
                            {% endif %}
                            {% if review.movie in user.favorites_list.all %}
                                <a href="{% url 'remove_favorites' movie_id=review.movie.tmdb_id %}" class="icon"><i class="far fa-eye"></i></a>
                            {% else %}
                                <a href="{% url 'add_favorites' movie_id=review.movie.tmdb_id %}" class="icon"><i class="far fa-eye-slash"></i></a>
                            {% endif %}
                            {% if review.movie in review.movie.all %}
                                <a href="#" class="icon"><i class="far fa-list-alt"></i></a>
                            {% else %}
                                <a href="{% url 'post_review' tmdb_id=review.movie.tmdb_id %}" class="icon"><i class="far fa-edit"></i></a>
                            {% endif %}
                        {% endif %}
                        <div class="review-overlay" data-after-content="{{review.creation_time}}   {{review.text}}">
                            <a href="{% url 'movie_detail' movie_id=review.movie.tmdb_id %}">
                                <img src="{{review.movie.poster_url}}" alt="{{review.movie.name}}" width=220>
                            </a>
                            <h6><a href="{% url 'movie_detail' movie_id=review.movie.tmdb_id %}">{{review.movie.name}}</a></h6>
                        </div>
                    </div>
                {% endfor %}
            </ul>
        </div>
    </div>

    <div class="carousel-container">
        <h5 class="list-title">Watch Again</h5>
        <div class="carousel">
            <ul>
                {% for movie in user.favorites_list.all %}
                    {% if movie.poster_url %}
                        <div class="carousel-item">
                            {% if request.user.is_authenticated %}
                                {% if movie in request.user.watch_list.all %}
                                    <a href="{% url 'remove_watchlist' tmdb_id=movie.tmdb_id %}" class="icon"><i class="far fa-check-square"></i></a>
                                {% else %}
                                    <a href="{% url 'add_watchlist' tmdb_id=movie.tmdb_id %}" class="icon"><i class="far fa-plus-square"></i></a>
                                {% endif %}
                                {% if movie in user.favorites_list.all %}
                                    <a href="{% url 'remove_favorites' movie_id=movie.tmdb_id %}" class="icon"><i class="far fa-eye"></i></a>
                                {% else %}
                                    <a href="{% url 'add_favorites' movie_id=movie.tmdb_id %}" class="icon"><i class="far fa-eye-slash"></i></a>
                                {% endif %}
                                {% if movie in review.movie.all %}
                                    <a href="#" class="icon"><i class="far fa-list-alt"></i></a>
                                {% else %}
                                    <a href="{% url 'post_review' tmdb_id=movie.tmdb_id %}" class="icon"><i class="far fa-edit"></i></a>
                                {% endif %}
                            {% endif %}
                            <a href="{% url 'movie_detail' movie_id=movie.tmdb_id %}">
                                <img src="{{movie.poster_url}}" alt="{{movie.name}}" width=220>
                            </a>
                            <h6><a href="{% url 'movie_detail' movie_id=movie.tmdb_id %}">{{ movie.name }}</a></h6>
                        </div>
                    {% endif %}
                {% endfor %}
            </ul>
        </div>
    </div>

    {% if recomendations %}
        <div class="carousel-container">
            <h5 class="list-title">You May Like</h5>
            <div class="carousel">
                <ul>
                    {% for recommendation in recomendations %}
                        <div class="carousel-item">
                            {% if request.user.is_authenticated %}
                                {% if recommendation in request.user.watch_list.all %}
                                    <a href="{% url 'remove_watchlist' tmdb_id=recommendation.id %}" class="icon"><i class="far fa-check-square"></i></a>
                                {% else %}
                                    <a href="{% url 'add_watchlist' tmdb_id=recommendation.id %}" class="icon"><i class="far fa-plus-square"></i></a>
                                {% endif %}
                                {% if recommendation in user.favorites_list.all %}
                                    <a href="{% url 'remove_favorites' movie_id=recommendation.id %}" class="icon"><i class="far fa-eye"></i></a>
                                {% else %}
                                    <a href="{% url 'add_favorites' movie_id=recommendation.id %}" class="icon"><i class="far fa-eye-slash"></i></a>
                                {% endif %}
                                {% if recommendation in review.movie.all %}
                                    <a href="#" class="icon"><i class="far fa-list-alt"></i></a>
                                {% else %}
                                    <a href="{% url 'post_review' tmdb_id=recommendation.id %}" class="icon"><i class="far fa-edit"></i></a>
                                {% endif %}
                            {% endif %}
                            <a href="{% url 'movie_detail' movie_id=recommendation.id %}">
                                <img src="https://image.tmdb.org/t/p/w154{{recommendation.poster_path}}" alt="{{recommendation.title}}" width=220>
                            </a>
                            <h6><a href="{% url 'movie_detail' movie_id=recommendation.id %}">{{ recommendation.title }}</a></h6>
                        </div>
                    {% endfor %}
                </ul>
            </div>
        </div>
    {% endif %}

{% endblock %}

{% block popup %}
    <div class="bio-scroll">
        <form action="" method="post" enctype="multipart/form-data" class="edit-modal photo-form">
            {% csrf_token %}
            {{ pic_form.as_p }}
            <input type="submit" class="more-bio submit" name='save_profile_pic'  value="Submit">
            <a href="#" onclick="editPhoto()" id="photo-edit" class="more-bio">Close</a>
        </form> 
    </div>
{% endblock %}

{% block display %}
    <div class="bio-scroll">
        <form action="" method="post" class="edit-modal">
            {% csrf_token %}
            {{ displayname_form.as_p }}
            <input type="submit" class="more-bio submit" name='save_displayname' value="Submit">
            <a href="#" onclick="editDisplayname()" id="display-edit" class="more-bio">Close</a>
        </form>   
    </div>
{% endblock %}

{% block bio %}
    <div class="bio-scroll">
        <form action="" method="post" class="edit-modal bio-form">
            {% csrf_token %}
            {{ bio_form.as_p }}
            <input type="submit" class="more-bio submit" name='save_bio' value="Submit">
            <a href="#" onclick="editBio()" id="bio-edit" class="more-bio">Close</a>
        </form>
    </div>
{% endblock %}
